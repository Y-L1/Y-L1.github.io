<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <link rel="stylesheet" href="Loader/styles.css">
  <link rel="stylesheet" href="Loader/input-styles.css">
  <link rel="stylesheet" href="Loader/loader-styles.css">
  <title>Luxe Leap</title>
</head>

<body style="text-align: center; padding: 0; border: 0; margin: 0;">
  <canvas id="unity-canvas" width=100vw height=100vh tabindex="-1"
    style="width: 100vw; height: 100vh; background: #1f1f1f"></canvas>
  <div id="loading-node" class="loading-container">
    <div class="loader-icon"></div>
    <!-- <div class="loading-text">
        <span class="dot">.</span><span class="dot">.</span><span class="dot">.</span>
      </div> -->
    <div id="loading-bar" class="loading-bar">
      <div class="white-bars-container">
        <div class="white-bar"></div>
        <div class="white-bar"></div>
        <div class="white-bar"></div>
        <div class="white-bar"></div>
        <div class="white-bar"></div>
        <div class="white-bar"></div>
        <div class="white-bar"></div>
        <div class="white-bar"></div>
        <div class="white-bar"></div>
        <div class="white-bar"></div>
      </div>
      <div id="percentage-text" class="percentage">0</div>
    </div>
    <div style="height: 15vh"></div>
  </div>
  <div id="overlay" class="overlay">
    <div class="modal">
      <div class="modal-text">TYPE HERE:</div>
      <input class="input" type="text" id="userInput" placeholder="">
      <div class="button-area">
        <button class="button-cancel" onclick="closeModal()">Cancel</button>
        <button class="button-done" onclick="confirmInput()">Done</button>
      </div>
    </div>
  </div>
  <script id="loader-script" src="Build/build.loader.js"></script>
  <script>
    var unityInstance = null;
    function closeModal() {
      document.getElementById('overlay').style.display = 'none';
      try {
        if (unityInstance) {
          unityInstance.SendMessage("BrowserInputReceiver", "OnEndInput");
        }
      } catch (error) {
      }
    }

    function confirmInput() {
      try {
        if (unityInstance) {
          const inputField = document.getElementById('userInput');
          const inputValue = inputField.value;
          unityInstance.SendMessage("BrowserInputReceiver", "OnInputReceived", inputValue);
          inputField.value = "";
        } else {
          console.warn("Failed to retrive input, unity instance is null.");
        }
      } catch (error) {
      }

      closeModal();
    }

    const onFinished = () => {
      console.log("Telegram sdk loaded.");
      console.log("Setting to fullscreen.");
      Telegram.WebApp.expand();
    };

    if (!window.Telegram) {
      var script = document.createElement("script");
      script.src = "https://telegram.org/js/telegram-web-app.js";
      script.onload = function () {
        if (typeof Telegram !== "undefined") {
          Telegram.WebApp.ready();

          onFinished();
        }
      };

      document.head.appendChild(script);
    } else {
      Telegram.WebApp.ready();
      onFinished();
    }

    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    if (isMobile) {
      var meta = document.createElement('meta');
      meta.name = 'viewport';
      meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
      document.getElementsByTagName('head')[0].appendChild(meta);
    }
    document.body.style.textAlign = "left";

    var canvas = document.querySelector("#unity-canvas");
    canvas.style.width = "100%";
    canvas.style.height = "100%";
    canvas.style.position = "fixed";

    let loadingNode = document.querySelector("#loading-node");
    let loadingBar = document.querySelector("#loading-bar");
    let loadingText = document.querySelector("#percentage-text");
    loadingBar.style.display = isMobile ? "flex" : "none";
    const onProgress = (progress) => {
      let realProgress = Math.min(progress + 0.1, 1);
      loadingBar.style.width = 100 * realProgress + "%";
      loadingText.textContent = Math.round(100 * realProgress);
    };

    if (isMobile) {
      createUnityInstance(document.querySelector("#unity-canvas"), {
        arguments: [],
        dataUrl: "Build/build.data",
        frameworkUrl: "Build/build.framework.js",
        codeUrl: "Build/build.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "Paradow",
        productName: "LuxeLeap",
        productVersion: "0.1.0",
        // matchWebGLToCanvasSize: false, // Uncomment this to separately control WebGL canvas render size and DOM element size.
        // devicePixelRatio: 1, // Uncomment this to override low DPI rendering on high DPI displays.
      }, onProgress).then((instance) => {
        unityInstance = instance;
        loadingNode.style.display = "None";
        console.log("Unity loaded. Instance: " + unityInstance !== null);
      });
    }
  </script>
</body>

</html>
